# V2.0 策略中心 任务清单

## 任务状态说明
- [ ] 待开始
- [x] 已完成

---

## Task 1: 话术关联 SOP 数据模型
**文件**: `prisma/schema.prisma`
**工时**: 0.5d

- [x] 1.1 ScriptTemplate 添加 sopId 字段
- [x] 1.2 添加 SopDefinition 关系
- [x] 1.3 运行 prisma migrate
- [x] 1.4 验证数据库变更

---

## Task 2: 策略中心页面
**文件**: `app/admin/strategy/page.tsx`
**工时**: 5d

- [x] 2.1 创建策略中心页面基础结构
- [x] 2.2 实现左侧策略列表（按阶段分组）
- [x] 2.3 实现右侧策略详情面板
- [x] 2.4 显示策略关联的话术
- [x] 2.5 实现策略创建/编辑功能
- [x] 2.6 实现话术关联功能
- [x] 2.7 添加到 Admin 导航

---

## Task 3: 话术匹配逻辑重构
**文件**: `app/api/coach/scripts/route.ts`
**工时**: 2d

- [x] 3.1 修改话术查询逻辑，支持 sopId
- [ ] 3.2 实现关联话术优先返回
- [x] 3.3 保持独立话术兼容
- [ ] 3.4 测试话术推荐功能

---

## Task 4: 标签管理中心
**文件**: `app/admin/tags/page.tsx`
**工时**: 2d

- [x] 4.1 创建标签管理页面
- [x] 4.2 实现标签列表展示
- [x] 4.3 实现标签分类筛选
- [x] 4.4 实现标签使用统计
- [x] 4.5 添加到 Admin 导航

---

## Task 5: 配置影响预览 API
**文件**: `app/api/admin/strategy/preview/route.ts`
**工时**: 1.5d

- [x] 5.1 创建预览 API
- [x] 5.2 实现标签条件匹配
- [x] 5.3 返回客户数和分布
- [x] 5.4 集成到策略中心页面

---

## Task 6: 原页面兼容
**文件**: `app/admin/sop/page.tsx`, `app/admin/scripts/page.tsx`
**工时**: 1d

- [ ] 6.1 SOP 页面添加策略中心入口提示
- [ ] 6.2 话术页面添加策略中心入口提示
- [x] 6.3 保持原有功能可用

---

## 验收检查清单

### 数据层
- [ ] ScriptTemplate.sopId 字段可用
- [ ] 话术可关联 SOP

### 策略中心
- [ ] 页面可访问
- [ ] 按阶段分组显示
- [ ] 策略详情显示关联话术
- [ ] 创建/编辑功能可用

### 标签管理
- [ ] 页面可访问
- [ ] 标签分类正确
- [ ] 使用统计准确

### 影响预览
- [ ] API 返回正确数据
- [ ] 页面集成正常

---

## 依赖关系

```
Task 1 (数据模型) ─┬─> Task 2 (策略中心)
                   └─> Task 3 (匹配逻辑)
                   
Task 4 (标签管理) ─── 独立

Task 5 (影响预览) ─── 依赖 Task 2

Task 6 (兼容) ─── 最后执行
```

**建议执行顺序**:
1. Task 1 (数据模型)
2. Task 2 + Task 4 (并行)
3. Task 3
4. Task 5
5. Task 6
