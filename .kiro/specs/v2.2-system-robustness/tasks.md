# V2.2 系统健壮 任务清单

## 任务状态说明
- [ ] 待开始
- [x] 已完成

---

## Task 1: 配置版本管理
**文件**: `prisma/schema.prisma`, `app/api/admin/config/`
**工时**: 3d

- [x] 1.1 添加 ConfigVersion 数据模型
- [x] 1.2 运行数据库迁移
- [x] 1.3 创建版本历史 API
- [x] 1.4 创建回滚 API
- [x] 1.5 在配置修改时自动记录版本

---

## Task 2: 配置导入导出
**文件**: `app/api/admin/config/export/route.ts`, `app/api/admin/config/import/route.ts`
**工时**: 2d

- [x] 2.1 创建导出 API
- [x] 2.2 创建导入 API
- [x] 2.3 实现格式校验
- [x] 2.4 实现冲突检测

---

## Task 3: 权限体系扩展
**文件**: `lib/authz.ts`
**工时**: 3d

- [x] 3.1 定义 5 级角色
- [x] 3.2 更新权限检查函数
- [x] 3.3 添加细粒度权限控制

---

## Task 4: 配置冲突检测
**文件**: `lib/config-validator.ts`
**工时**: 2d

- [x] 4.1 创建冲突检测函数
- [x] 4.2 实现 SOP 规则冲突检测
- [x] 4.3 实现话术一致性检测
- [x] 4.4 实现无效标签检测

---

## Task 5: 配置依赖可视化
**文件**: `app/admin/strategy/dependencies/page.tsx`
**工时**: 2d

- [x] 5.1 创建依赖关系页面
- [x] 5.2 实现关系数据获取
- [x] 5.3 实现图形化展示

---

## 验收检查清单

### 版本管理
- [x] 版本记录可用
- [x] 历史查看可用
- [x] 回滚功能可用

### 导入导出
- [x] 导出 JSON 可用
- [x] 导入校验正常

### 权限体系
- [x] 5级角色定义
- [x] 权限检查正常

### 冲突检测
- [x] 规则冲突检测
- [x] 一致性检测

### 依赖可视化
- [x] 页面可访问
- [x] 关系图正确
