# 系统功能与内容依赖结构

## 一、系统架构概览

```
┌─────────────────────────────────────────────────────────────────┐
│                        三段陪跑销售引擎                           │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐        │
│  │   用户端    │    │   助教端    │    │  Admin端   │        │
│  │  /t/[token] │    │   /coach    │    │   /admin   │        │
│  └──────┬──────┘    └──────┬──────┘    └──────┬──────┘        │
│         │                  │                  │                │
│         ▼                  ▼                  ▼                │
│  ┌─────────────────────────────────────────────────────┐      │
│  │                    API 层                            │      │
│  │  /api/public  │  /api/coach  │  /api/admin          │      │
│  └─────────────────────────────────────────────────────┘      │
│                           │                                    │
│                           ▼                                    │
│  ┌─────────────────────────────────────────────────────┐      │
│  │                  数据库 (PostgreSQL)                 │      │
│  │  User │ Customer │ Attempt │ SOP │ Script │ Tag     │      │
│  └─────────────────────────────────────────────────────┘      │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

## 二、核心数据模型关系

```
┌──────────────┐     ┌──────────────┐     ┌──────────────┐
│     User     │────▶│   Customer   │────▶│   Attempt    │
│   (助教)     │     │   (客户)     │     │  (测评记录)  │
└──────────────┘     └──────────────┘     └──────────────┘
       │                    │                    │
       │                    │                    ▼
       │                    │            ┌──────────────┐
       │                    │            │   tagsJson   │
       │                    │            │  (标签数组)  │
       │                    │            └──────────────┘
       │                    │                    │
       ▼                    ▼                    ▼
┌──────────────┐     ┌──────────────┐     ┌──────────────┐
│   Invite     │     │  CoachTag    │     │  SopRule     │
│  (邀请链接)  │     │ (助教标签)   │     │ (触发规则)   │
└──────────────┘     └──────────────┘     └──────────────┘
                                                │
                                                ▼
                                         ┌──────────────┐
                                         │SopDefinition │
                                         │  (策略定义)  │
                                         └──────────────┘
                                                │
                                                ▼
                                         ┌──────────────┐
                                         │ScriptTemplate│
                                         │  (话术模板)  │
                                         └──────────────┘
```

## 三、标签系统结构

### 标签分类

| 前缀 | 类型 | 来源 | 用途 |
|------|------|------|------|
| `image:` | 画像标签 | 测评计算 | 客户行为类型分类 |
| `stability:` | 稳定性标签 | 测评计算 | 回答集中度评估 |
| `phase:` | 阶段标签 | 测评完成 | 测评完成状态 |
| `rule:/risk:/emotion:` 等 | 行为标签 | 测评计算 | 各维度评分 |
| `segment:` | 分层标签 | 系统计算 | 客户价值分层 |
| `coach:` | 助教标签 | 助教手动 | 自定义标记 |

### 画像标签详情

| 标签Key | 显示名称 | 说明 |
|---------|----------|------|
| `image:rule_executor` | 规则对齐型 | 更习惯先对齐规则/边界再推进 |
| `image:emotion_driven` | 感受牵引型 | 反馈强烈时节奏更容易被带动 |
| `image:experience_reliant` | 经验依赖型 | 更常用熟悉打法来判断下一步 |
| `image:opportunity_seeker` | 机会关注型 | 更容易被新信息吸引而调整方向 |
| `image:defensive_observer` | 谨慎观望型 | 不明朗时更倾向先观察再行动 |
| `image:impulsive_reactor` | 快速反应型 | 更容易先动起来，再边做边校准 |

### 行为维度标签

| 维度 | 高 | 中 | 低 |
|------|----|----|-----|
| 规则依赖 | `rule:high` | `rule:medium` | `rule:low` |
| 风险防御 | `risk:high` | `risk:medium` | `risk:low` |
| 情绪介入 | `emotion:high` | `emotion:medium` | `emotion:low` |
| 行动一致性 | `consistency:high` | `consistency:medium` | `consistency:low` |
| 机会敏感 | `opportunity:high` | `opportunity:medium` | `opportunity:low` |
| 经验依赖 | `experience:high` | `experience:medium` | `experience:low` |

## 四、陪跑阶段定义

| 阶段ID | 名称 | 核心目标 | 适用场景 |
|--------|------|----------|----------|
| `pre` | 认知建立期 | 建立信任、了解需求 | 首次接触、初步沟通 |
| `mid` | 行动推进期 | 方案沟通、疑虑解答 | 深入交流、推进决策 |
| `post` | 成果巩固期 | 行为复盘、强化变化 | 成交后、持续跟进 |

## 五、内容配置依赖关系

```
┌─────────────────────────────────────────────────────────────┐
│                      配置依赖链                              │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   标签定义 ──────▶ SOP触发规则 ──────▶ SOP策略定义          │
│      │                                      │               │
│      │                                      ▼               │
│      │                               话术模板               │
│      │                                      │               │
│      ▼                                      ▼               │
│   客户测评 ──────▶ 标签匹配 ──────▶ 策略推荐 ──▶ 话术推荐  │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

## 六、现有内容审查

### 已配置内容

| 内容类型 | 数量 | 状态 | 建议 |
|----------|------|------|------|
| 画像标签 | 6种 | ✅ 完整 | 可根据业务扩展 |
| 行为维度 | 6维度×3级 | ✅ 完整 | 无需修改 |
| 陪跑阶段 | 3阶段 | ✅ 完整 | 无需修改 |
| SOP策略 | 待检查 | ⚠️ 需审查 | 确保每阶段有策略 |
| 话术模板 | 待检查 | ⚠️ 需审查 | 确保覆盖主要场景 |
| 训练计划 | 待检查 | ⚠️ 需审查 | 建议创建示例计划 |

### 内容填充建议

#### 1. SOP策略建议（每阶段至少3个）

**认知建立期 (pre)**
- 首次接触-规则型客户：强调流程和规范
- 首次接触-情绪型客户：建立情感连接
- 首次接触-观望型客户：降低防御心理

**行动推进期 (mid)**
- 方案沟通-高意向客户：快速推进决策
- 疑虑解答-犹豫客户：逐一化解顾虑
- 价值强化-比较客户：突出差异化优势

**成果巩固期 (post)**
- 成交跟进-新客户：确认满意度
- 复购引导-老客户：挖掘新需求
- 流失挽回-沉默客户：重新激活

#### 2. 话术模板建议（每分类至少5条）

**首次沟通**
- 开场白（通用）
- 开场白（规则型）
- 开场白（情绪型）
- 需求挖掘
- 建立信任

**跟进沟通**
- 进度确认
- 疑虑解答
- 价值强调
- 紧迫感营造
- 决策推动

**转化促成**
- 优惠说明
- 限时提醒
- 案例分享
- 承诺保障
- 成交确认

**复测邀请**
- 复测提醒
- 变化说明
- 价值回顾
- 持续服务

#### 3. 训练计划建议

**7天行为训练计划**
- Day 1: 认识自己的行为模式
- Day 2: 理解规则与边界
- Day 3: 情绪觉察练习
- Day 4: 决策复盘方法
- Day 5: 行动一致性训练
- Day 6: 机会评估框架
- Day 7: 综合应用与总结

## 七、数据库字段审查

### 冗余字段检查

| 表 | 字段 | 状态 | 建议 |
|----|------|------|------|
| User | 所有字段 | ✅ 使用中 | 保留 |
| Customer | 所有字段 | ✅ 使用中 | 保留 |
| Attempt | 所有字段 | ✅ 使用中 | 保留 |
| SopDefinition | 所有字段 | ✅ 使用中 | 保留 |
| SopRule | 所有字段 | ✅ 使用中 | 保留 |
| ScriptTemplate | 所有字段 | ✅ 使用中 | 保留 |

### 字段命名一致性

- ✅ 所有时间字段使用 `createdAt`/`updatedAt`
- ✅ 所有JSON字段使用 `xxxJson` 后缀
- ✅ 所有外键使用 `xxxId` 命名
- ✅ 数据库列名使用 snake_case（通过 @map）

## 八、优化建议总结

### 立即执行
1. ✅ 修复标签显示名称（画像→推进方式问题）
2. ✅ 完善页面描述内容
3. ✅ 添加助教信息编辑功能
4. ✅ 添加数据看板明细查看

### 短期优化
1. 补充SOP策略内容（每阶段3-5个）
2. 补充话术模板（每分类5-10条）
3. 创建示例训练计划
4. 添加内容导入导出功能

### 长期规划
1. 标签效果分析（哪些标签组合转化率高）
2. 话术效果追踪（使用次数、转化关联）
3. 策略优化建议（基于数据的自动推荐）
